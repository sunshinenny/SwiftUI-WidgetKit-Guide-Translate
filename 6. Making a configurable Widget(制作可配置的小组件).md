# åˆ¶ä½œä¸€ä¸ªå¯é…ç½®çš„å°éƒ¨ä»¶

é€šè¿‡åœ¨æ‚¨çš„é¡¹ç›®ä¸­æ·»åŠ è‡ªå®šä¹‰SiriKitæ„å›¾å®šä¹‰ï¼Œè®©ç”¨æˆ·å¯ä»¥é€‰æ‹©è‡ªå®šä¹‰ä»–ä»¬çš„å°éƒ¨ä»¶ã€‚

## æ¦‚è¿°

ä¸ºäº†ä½¿ç”¨æˆ·èƒ½å¤Ÿè½»æ¾è®¿é—®æœ€ç›¸å…³çš„ä¿¡æ¯ï¼Œå°ç»„ä»¶å¯ä»¥æä¾›å¯å®šåˆ¶çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥ä¸ºè‚¡ç¥¨æŠ¥ä»·å°ç»„ä»¶é€‰æ‹©ç‰¹å®šçš„è‚¡ç¥¨ï¼Œæˆ–ä¸ºåŒ…è£¹äº¤ä»˜å°ç»„ä»¶è¾“å…¥è·Ÿè¸ªå·ç ã€‚å°ç»„ä»¶é€šè¿‡ä½¿ç”¨è‡ªå®šä¹‰æ„å›¾å®šä¹‰æ¥å®šä¹‰å¯å®šåˆ¶çš„å±æ€§ï¼Œä¸Siriå»ºè®®å’ŒSiriå¿«æ·æ–¹å¼ç”¨äºå®šåˆ¶è¿™äº›äº¤äº’çš„æœºåˆ¶ç›¸åŒã€‚

æ·»åŠ å¯é…ç½®çš„å±æ€§åˆ°æ‚¨çš„widgetä¸­ã€‚

1. æ·»åŠ ä¸€ä¸ªå®šä¹‰å¯é…ç½®å±æ€§çš„è‡ªå®šä¹‰æ„å›¾å®šä¹‰åˆ°ä½ çš„Xcodeé¡¹ç›®ä¸­ã€‚
2. åœ¨æ‚¨çš„widgetä¸­ä½¿ç”¨`IntentTimelineProvider`æ¥å°†ç”¨æˆ·çš„é€‰æ‹©çº³å…¥æ‚¨çš„æ—¶é—´çº¿æ¡ç›®ä¸­ã€‚
3. å¦‚æœå±æ€§ä¾èµ–äºåŠ¨æ€æ•°æ®ï¼Œè¯·å®ç°ä¸€ä¸ª`Intents`æ‰©å±•ã€‚

å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå·²ç»æ”¯æŒ Siri å»ºè®®æˆ– Siri å¿«æ·æ–¹å¼ï¼Œå¹¶ä¸”æ‚¨æœ‰ä¸€ä¸ªè‡ªå®šä¹‰æ„å›¾ï¼Œæ‚¨å¯èƒ½å·²ç»å®Œæˆäº†å¤§éƒ¨åˆ†å·¥ä½œã€‚å¦åˆ™ï¼Œè¯·è€ƒè™‘åˆ©ç”¨æ‚¨ä¸ºå°ç»„ä»¶æ‰€åšçš„å·¥ä½œæ¥æ·»åŠ å¯¹ Siri å»ºè®®æˆ– Siri å¿«æ·æ–¹å¼çš„æ”¯æŒã€‚æœ‰å…³å¦‚ä½•å……åˆ†åˆ©ç”¨æ„å›¾çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… SiriKitã€‚
ä¸‹ä¸€èŠ‚ä»‹ç»å¦‚ä½•ç»™æ˜¾ç¤ºæ¸¸æˆä¸­è§’è‰²ä¿¡æ¯çš„å°ç»„ä»¶æ·»åŠ å¯é…ç½®å±æ€§ã€‚

## ä¸ºæ‚¨çš„é¡¹ç›®æ·»åŠ è‡ªå®šä¹‰æ„å›¾å®šä¹‰

åœ¨ä½ çš„Xcodeé¡¹ç›®ä¸­ï¼Œé€‰æ‹©File > New Fileå¹¶é€‰æ‹©SiriKit Intent Definition Fileã€‚ç‚¹å‡» "ä¸‹ä¸€æ­¥ "å¹¶åœ¨æç¤ºæ—¶ä¿å­˜æ–‡ä»¶ã€‚Xcodeåˆ›å»ºä¸€ä¸ªæ–°çš„.intenttdefinitionæ–‡ä»¶ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„é¡¹ç›®ä¸­ã€‚

![WidgetKit-Add-Intent-Definition-File@2x](assets/WidgetKit-Add-Intent-Definition-File@2x.png)

Xcodeä»æ„å›¾å®šä¹‰ã€Œintent definition fileã€æ–‡ä»¶ä¸­ç”Ÿæˆä»£ç ã€‚è¦åœ¨ä¸€ä¸ªç›®æ ‡ã€Œtargetã€ä¸­ä½¿ç”¨è¿™äº›ä»£ç ã€‚

- å°†intentå®šä¹‰æ–‡ä»¶ä½œä¸ºç›®æ ‡çš„ä¸€ä¸ªæˆå‘˜ã€‚
- é€šè¿‡æ·»åŠ  intent çš„ç±»ååˆ° target å±æ€§çš„ Supported Intents éƒ¨åˆ†æ¥æŒ‡å®šè¦åŒ…å«åœ¨ target ä¸­çš„ç‰¹å®š intentsã€‚

å¦‚æœæ‚¨å°† intent å®šä¹‰æ–‡ä»¶åŒ…å«åœ¨æ¡†æ¶ä¸­ï¼Œæ‚¨è¿˜å¿…é¡»å°†å…¶åŒ…å«åœ¨åŒ…å«åº”ç”¨ç¨‹åºçš„ target ä¸­ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºäº†é¿å…åº”ç”¨ç¨‹åºå’Œæ¡†æ¶ä¸­çš„ç±»å‹é‡å¤ï¼Œè¯·åœ¨ "æ–‡ä»¶ "æ£€æŸ¥å™¨çš„ "ç›®æ ‡æˆå‘˜ "éƒ¨åˆ†ä¸­ä¸ºåº”ç”¨ç¨‹åºç›®æ ‡é€‰æ‹© "ä¸ç”Ÿæˆç±»"ã€‚

****

è¦æ·»åŠ å’Œé…ç½®ä¸€ä¸ªè‡ªå®šä¹‰æ„å›¾ï¼Œè®©ç”¨æˆ·åœ¨æ¸¸æˆä¸­é€‰æ‹©ä¸€ä¸ªè§’è‰²ã€‚

1. åœ¨é¡¹ç›®å¯¼èˆªå™¨ä¸­ï¼Œé€‰æ‹©æ„å›¾æ–‡ä»¶ã€‚Xcodeæ˜¾ç¤ºä¸€ä¸ªç©ºçš„æ„å›¾å®šä¹‰ç¼–è¾‘å™¨ã€‚
2. é€‰æ‹© Editor > New Intent å¹¶é€‰æ‹© Custom Intents ä¸‹çš„ intentã€‚
3. å°†è‡ªå®šä¹‰æ„å›¾çš„åç§°æ”¹ä¸ºSelectCharacterã€‚è¯·æ³¨æ„ï¼Œ"å±æ€§æ£€æŸ¥å™¨ "çš„ "è‡ªå®šä¹‰ç±» "å­—æ®µæ˜¾ç¤ºäº†æ‚¨åœ¨ä»£ç ä¸­å¼•ç”¨è¯¥æ„å›¾æ—¶ä½¿ç”¨çš„ç±»åã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒæ˜¯SelectCharacterIntentã€‚
4. å°†Categoryï¼ˆç±»åˆ«ï¼‰è®¾ç½®ä¸ºViewï¼ˆè§†å›¾ï¼‰ï¼Œå¹¶é€‰æ‹© "Intent is eligible for widgets "ã€Œæ„å›¾æœ‰èµ„æ ¼æˆä¸ºå°éƒ¨ä»¶ã€å¤é€‰æ¡†ï¼Œä»¥è¡¨æ˜widgetså¯ä»¥ä½¿ç”¨è¯¥intentã€‚
5. åœ¨ "Parameters "ä¸‹ï¼Œæ·»åŠ ä¸€ä¸ªæ–°å‚æ•°ï¼Œä»¥å­—ç¬¦ä¸²ä½œä¸ºåç§°ï¼Œè¿™æ˜¯å°ç»„ä»¶çš„å¯é…ç½®è®¾ç½®ã€‚
![WidgetKit-Configure-Custom-Intent@2x](assets/WidgetKit-Configure-Custom-Intent@2x.png)

æ·»åŠ ä¸€ä¸ªå‚æ•°åï¼Œä¸ºå…¶é…ç½®ç»†èŠ‚ã€‚å¦‚æœä¸€ä¸ªå‚æ•°ç»™ç”¨æˆ·æä¾›äº†ä¸€ä¸ªé™æ€çš„é€‰æ‹©åˆ—è¡¨ï¼Œé‚£ä¹ˆé€‰æ‹© "æ·»åŠ æšä¸¾ "èœå•é¡¹æ¥åˆ›å»ºä¸€ä¸ªé™æ€æšä¸¾ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå‚æ•°æŒ‡å®šäº†ä¸€ä¸ªè§’è‰²çš„å¤´åƒï¼Œè€Œå¯èƒ½çš„å¤´åƒåˆ—è¡¨æ˜¯ä¸€ä¸ªä¸å˜çš„é›†åˆï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé™æ€æšä¸¾ï¼Œåœ¨æ„å›¾å®šä¹‰æ–‡ä»¶ä¸­æŒ‡å®šå¯ç”¨çš„é€‰æ‹©ã€‚

å¦‚æœå¯èƒ½çš„å¤´åƒåˆ—è¡¨å¯ä»¥å˜åŒ–ï¼Œæˆ–è€…æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰åŠ¨æ€é€‰é¡¹çš„ç±»å‹ä»£æ›¿ã€‚

åœ¨æœ¬ä¾‹ä¸­ï¼Œå­—ç¬¦å±æ€§ä¾èµ–äºåº”ç”¨ç¨‹åºä¸­å¯ç”¨çš„åŠ¨æ€å­—ç¬¦åˆ—è¡¨ã€‚è¦æä¾›åŠ¨æ€æ•°æ®ï¼Œè¯·åˆ›å»ºä¸€ä¸ªæ–°ç±»å‹ã€‚

1. ç‚¹å‡» "å·¦ä¸‹è§’ + æŒ‰é’®"ï¼Œé€‰æ‹© "New Type"ã€‚Xcodeåœ¨ç¼–è¾‘å™¨çš„Typeséƒ¨åˆ†æ·»åŠ ä¸€ä¸ªæ–°ç±»å‹ã€‚

2. å°†è¯¥ç±»å‹çš„åç§°æ”¹ä¸ºGameCharacterã€‚
   æ·»åŠ ä¸€ä¸ªæ–°çš„nameå±æ€§ï¼Œå¹¶ä»ç±»å‹å¼¹å‡ºèœå•ä¸­é€‰æ‹©Stringã€‚

3. é€‰æ‹© SelectCharacter intentã€‚

4. åœ¨æ„å›¾ç¼–è¾‘å™¨ä¸­ï¼Œé€‰æ‹© "é€‰é¡¹æ˜¯åŠ¨æ€æä¾›çš„ã€ŒOptions are provided dynamicallyã€ "å¤é€‰æ¡†ï¼Œä»¥è¡¨æ˜æ‚¨çš„ä»£ç ä¸ºè¯¥å‚æ•°æä¾›äº†ä¸€ä¸ªåŠ¨æ€é¡¹ç›®åˆ—è¡¨ã€‚

![WidgetKit-Add-Custom-Type@2x](assets/WidgetKit-Add-Custom-Type@2x.png)

GameCharacterç±»å‹æè¿°äº†ç”¨æˆ·å¯ä»¥é€‰æ‹©çš„å­—ç¬¦ã€‚åœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œä½ å°†æ·»åŠ ä»£ç æ¥åŠ¨æ€åœ°æä¾›å­—ç¬¦åˆ—è¡¨ã€‚

> #### Note
>
> æ„å›¾ä¸­å‚æ•°çš„é¡ºåºå†³å®šäº†ç”¨æˆ·ç¼–è¾‘å°ç»„ä»¶æ—¶å®ƒä»¬çš„æ˜¾ç¤ºé¡ºåºã€‚æ‚¨å¯ä»¥é€šè¿‡æ‹–åŠ¨åˆ—è¡¨ä¸­çš„é¡¹ç›®æ¥é‡æ–°æ’åºã€‚

****

### ä¸ºæ‚¨çš„é¡¹ç›®æ·»åŠ ä¸€ä¸ªIntentæ‰©å±•

è¦åŠ¨æ€åœ°æä¾›å­—ç¬¦åˆ—è¡¨ï¼Œä½ éœ€è¦åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ªIntentsæ‰©å±•ã€‚å½“ç”¨æˆ·ç¼–è¾‘widgetæ—¶ï¼ŒWidgetKitä¼šåŠ è½½Intentsæ‰©å±•æ¥æä¾›åŠ¨æ€ä¿¡æ¯ã€‚

æ·»åŠ ä¸€ä¸ª Intents æ‰©å±•ã€‚

1. é€‰æ‹©File > New > Target å¹¶é€‰æ‹© Intents Extensionã€‚

2. ç‚¹å‡» "ä¸‹ä¸€æ­¥"ã€‚

3. ä¸ºä½ çš„Intentsæ‰©å±•åè¾“å…¥ä¸€ä¸ªåå­—ï¼Œå¹¶å°†Starting Point(èµ·å§‹ç‚¹)è®¾ç½®ä¸ºnoneã€‚

4. å•å‡» "Finish"ã€‚å¦‚æœXcodeæç¤ºæ‚¨æ¿€æ´»æ–°æ–¹æ¡ˆï¼Œè¯·ç‚¹å‡»æ¿€æ´»ã€‚

5. ç‚¹å‡»æ ¹å¯¹è±¡ï¼Œæ‰¾åˆ°å·¦ä¾§è¾¹æ çš„Targetsä¸­åˆšæ–°å»ºçš„å¯¹è±¡ã€‚åœ¨å…¶"General"é€‰é¡¹å¡ä¸­ï¼Œåœ¨   "Supported Intents"éƒ¨åˆ†æ·»åŠ ä¸€ä¸ªæ¡ç›®ï¼Œå¹¶å°† "Class Name"è®¾ç½®ä¸º"SelectCharacterIntent"ã€‚

   ![image-20200624183627237](assets/image-20200624183627237.png)

6. åœ¨ "é¡¹ç›®å¯¼èˆªå™¨ "ä¸­ï¼Œé€‰æ‹©æ‚¨ä¹‹å‰æ·»åŠ çš„è‡ªå®šä¹‰æ„å›¾å®šä¹‰æ–‡ä»¶ã€‚

7. ä½¿ç”¨æ–‡ä»¶æ£€æŸ¥å™¨ã€ŒFile inspectorã€å°†Intentæ–‡ä»¶æ·»åŠ åˆ°æ„å›¾æ‰©å±•ç›®æ ‡ä¸­ã€‚

> #### Important
>
> åœ¨æ–‡ä»¶æ£€æŸ¥å™¨ä¸­ï¼ŒéªŒè¯åŒ…å«çš„åº”ç”¨ç¨‹åºã€å°ç»„ä»¶æ‰©å±•åå’Œæ„å›¾æ‰©å±•åæ˜¯å¦éƒ½åŒ…å«æ„å›¾Intent Definitionæ–‡ä»¶ã€‚

### å®ç°ä¸€ä¸ªæ„å›¾å¤„ç†ç¨‹åºæ¥æä¾›åŠ¨æ€å€¼

å½“ç”¨æˆ·ä½¿ç”¨æä¾›åŠ¨æ€å€¼çš„è‡ªå®šä¹‰æ„å›¾ç¼–è¾‘å°ç»„ä»¶æ—¶ï¼Œç³»ç»Ÿéœ€è¦ä¸€ä¸ªå¯¹è±¡æ¥æä¾›è¿™äº›å€¼ã€‚å®ƒé€šè¿‡è¦æ±‚Intentsæ‰©å±•ä¸ºæ„å›¾æä¾›ä¸€ä¸ªå¤„ç†ç¨‹åºæ¥è¯†åˆ«è¿™ä¸ªå¯¹è±¡ã€‚

å½“Xcodeåˆ›å»ºIntentsæ‰©å±•æ—¶ï¼Œå®ƒå‘æ‚¨çš„é¡¹ç›®æ·»åŠ äº†ä¸€ä¸ªåä¸ºIntentHandler.swiftçš„æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªåä¸ºIntentHandlerçš„ç±»ã€‚è¿™ä¸ªç±»åŒ…å«ä¸€ä¸ªè¿”å›å¤„ç†ç¨‹åºçš„æ–¹æ³•ã€‚**æ‚¨å°†æ‰©å±•è¯¥å¤„ç†ç¨‹åºï¼Œä¸ºå°ç»„ä»¶çš„è‡ªå®šä¹‰æä¾›å€¼ã€‚**

åŸºäºè‡ªå®šä¹‰çš„æ„å›¾å®šä¹‰æ–‡ä»¶ï¼ŒXcodeä¼šç”Ÿæˆä¸€ä¸ªåè®®ï¼Œå³SelectCharacterIntentHandlingï¼Œè¯¥å¤„ç†ç¨‹åºå¿…é¡»ç¬¦åˆè¿™ä¸ªåè®®ã€‚å°†è¿™ä¸ªç¬¦åˆæ€§æ·»åŠ åˆ°IntentHandlerç±»çš„å£°æ˜ä¸­ã€‚(è¦æŸ¥çœ‹è¿™ä¸ªåè®®çš„ç»†èŠ‚ï¼Œä»¥åŠXcodeè‡ªåŠ¨ç”Ÿæˆçš„å…¶ä»–ç±»å‹ï¼Œè¯·é€‰æ‹©SelectCharacterIntentHandlingå¹¶é€‰æ‹©Navigate > Jump to Definition)ã€‚

```swift
class IntentHandler: INExtension, SelectCharacterIntentHandling {
    ...
}
```

å½“ä¸€ä¸ªå¤„ç†ç¨‹åºæä¾›åŠ¨æ€é€‰é¡¹æ—¶ï¼Œå®ƒå¿…é¡»å®ç°ä¸€ä¸ªåä¸º`provide[Type] OptionalCollection(for:with:)`çš„æ–¹æ³•ï¼Œå…¶ä¸­[Type]æ˜¯æ¥è‡ªæ„å›¾å®šä¹‰æ–‡ä»¶çš„ç±»å‹åç§°ã€‚å¦‚æœç¼ºå°‘è¿™ä¸ªæ–¹æ³•ï¼ŒXcodeä¼šæŠ¥å‘Šä¸€ä¸ªæ„å»ºé”™è¯¯ï¼Œå¹¶æä¾›ä¸€ä¸ªæ·»åŠ åè®®å­˜æ ¹çš„ä¿®å¤æ–¹æ³•ã€‚

æ„å»ºæ‚¨çš„é¡¹ç›®ï¼Œå¹¶ä½¿ç”¨fix-itæ¥æ·»åŠ è¿™ä¸ªå­˜æ ¹ã€‚
è¯¥æ–¹æ³•åŒ…æ‹¬ä¸€ä¸ªæ‚¨è°ƒç”¨çš„å®Œæˆå¤„ç†ç¨‹åºï¼Œä¼ é€’ä¸€ä¸ªINObjectCollection<GameCharacter>ã€‚è¯·æ³¨æ„GameCharacterç±»å‹ï¼›è¿™æ˜¯æ„å›¾å®šä¹‰æ–‡ä»¶ä¸­çš„è‡ªå®šä¹‰ç±»å‹ã€‚Xcodeç”Ÿæˆå®šä¹‰å®ƒçš„ä»£ç å¦‚ä¸‹ã€‚

```swift
public class GameCharacter: INObject {
    @available(iOS 13.0, macOS 10.16, watchOS 6.0, *)
    @NSManaged public var name: String?
}
```

è¯·æ³¨æ„nameå±æ€§ï¼Œå®ƒä¹Ÿæ¥è‡ªäºä½ æ·»åŠ çš„è‡ªå®šä¹‰ç±»å‹çš„æ„å›¾å®šä¹‰æ–‡ä»¶ã€‚
ä¸ºäº†å®ç°provideCharacterOptionsCollection(for:with:)æ–¹æ³•ï¼Œwidgetä½¿ç”¨ä¸€ä¸ªå­˜åœ¨äºæ¸¸æˆé¡¹ç›®ä¸­çš„ç»“æ„ã€‚è¿™ä¸ªç»“æ„å®šä¹‰äº†ä¸€ä¸ªå¯ç”¨è§’è‰²çš„åˆ—è¡¨å’Œå®ƒä»¬çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```swift
struct CharacterDetail {
    let name: String
    let avatar: String
    let healthLevel: Double
    let heroType: String

    static let availableCharacters = [
        CharacterDetail(name: "Power Panda", avatar: "ğŸ¼", healthLevel: 0.14, heroType: "Forest Dweller"),
        CharacterDetail(name: "Unipony", avatar: "ğŸ¦„", healthLevel: 0.67, heroType: "Free Rangers"),
        CharacterDetail(name: "Spouty", avatar: "ğŸ³", healthLevel: 0.83, heroType: "Deep Sea Goer")
    ]
}
```

åœ¨æ„å›¾å¤„ç†ç¨‹åºä¸­ï¼Œéå†availableCharactersæ•°ç»„ï¼Œä¸ºæ¯ä¸ªè§’è‰²åˆ›å»ºä¸€ä¸ªGameCharacterå¯¹è±¡ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼ŒGameCharacterçš„æ ‡è¯†æ˜¯è§’è‰²çš„åå­—ã€‚æ¸¸æˆè§’è‰²æ•°ç»„è¢«æ”¾å…¥ä¸€ä¸ªINObjectCollectionä¸­ï¼Œå¤„ç†ç¨‹åºå°†è¯¥é›†åˆä¼ é€’ç»™å®Œæˆå¤„ç†ç¨‹åºã€‚

```swift
class IntentHandler: INExtension, SelectCharacterIntentHandling {
    func provideCharacterOptionsCollection(for intent: SelectCharacterIntent, with completion: @escaping (INObjectCollection<GameCharacter>?, Error?) -> Void) {

        // è¿­ä»£å¯ç”¨çš„å­—ç¬¦
        // æ¯ä¸ªéƒ½æœ‰ä¸€ä¸ªGameCharacterã€‚
        let characters: [GameCharacter] = CharacterDetail.availableCharacters.map { character in
            let gameCharacter = GameCharacter(
                identifier: character.name,
                display: character.name
            )
            gameCharacter.name = character.name
            return gameCharacter
        }

        // ç”¨å­—ç¬¦æ•°ç»„åˆ›å»ºä¸€ä¸ªé›†åˆã€‚
        let collection = INObjectCollection(items: characters)

        // è°ƒç”¨å®Œæˆå¤„ç†ç¨‹åºï¼Œä¼ é€’é›†åˆã€‚
        completion(collection, nil)
    }
}
```

å®Œæˆäº†æ„å›¾å®šä¹‰æ–‡ä»¶çš„é…ç½®ï¼Œå¹¶å°†æ„å›¾æ‰©å±•æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­ï¼Œç”¨æˆ·å°±å¯ä»¥ç¼–è¾‘å°ç»„ä»¶æ¥é€‰æ‹©è¦æ˜¾ç¤ºçš„ç‰¹å®šå­—ç¬¦ã€‚WidgetKitä½¿ç”¨æ„å›¾å®šä¹‰æ–‡ä»¶ä¸­çš„ä¿¡æ¯è‡ªåŠ¨åˆ›å»ºç¼–è¾‘å°ç»„ä»¶çš„ç”¨æˆ·ç•Œé¢ã€‚

ä¸€æ—¦ç”¨æˆ·ç¼–è¾‘å°ç»„ä»¶å¹¶é€‰æ‹©äº†ä¸€ä¸ªå­—ç¬¦ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯å°†è¯¥é€‰æ‹©çº³å…¥å°ç»„ä»¶çš„æ˜¾ç¤ºä¸­ã€‚

### å¤„ç†ç”¨æˆ·è‡ªå®šä¹‰çš„å€¼

ä¸ºäº†æ”¯æŒå¯é…ç½®çš„å±æ€§ï¼Œå°ç»„ä»¶ä½¿ç”¨ IntentTimelineProvider é…ç½®ã€‚ä¾‹å¦‚ï¼ŒCharacter-detailå°ç»„ä»¶å®šä¹‰å…¶é…ç½®å¦‚ä¸‹ã€‚

```swift
struct CharacterDetailWidget: Widget {
    var body: some WidgetConfiguration {
        IntentConfiguration(
            kind: "com.mygame.character-detail",
            intent: SelectCharacterIntent.self,
            provider: CharacterDetailProvider(),
            placeholder: CharacterPlaceholderView()
        ) { entry in
            CharacterDetailView(entry: entry)
        }
        .configurationDisplayName("Character Details")
        .description("Displays a character's health and other details")
        .supportedFamilies([.systemSmall, .systemMedium, .systemLarge])
    }
}
```

SelectCharacterIntentå‚æ•°å†³å®šäº†å°ç»„ä»¶çš„ç”¨æˆ·å¯å®šåˆ¶å±æ€§ã€‚

é…ç½®ä½¿ç”¨ CharacterDetailProvider æ¥ç®¡ç†å°ç»„ä»¶çš„æ—¶é—´çº¿äº‹ä»¶ã€‚æœ‰å…³æ—¶é—´çº¿æä¾›è€…çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ "ä¿æŒ Widget æ›´æ–°"ã€‚

åœ¨ç”¨æˆ·ç¼–è¾‘å°ç»„ä»¶åï¼ŒWidgetKitä¼šåœ¨è¯·æ±‚æ—¶é—´çº¿æ¡ç›®æ—¶å°†ç”¨æˆ·è‡ªå®šä¹‰çš„å€¼ä¼ é€’ç»™æä¾›è€…ã€‚æ‚¨é€šå¸¸ä¼šåœ¨æä¾›è€…ç”Ÿæˆçš„æ—¶é—´çº¿æ¡ç›®ä¸­åŒ…å«æ¥è‡ªæ„å›¾çš„ç›¸å…³ç»†èŠ‚ã€‚

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæä¾›è€…ä½¿ç”¨ä¸€ä¸ªè¾…åŠ©æ–¹æ³•ï¼Œä½¿ç”¨æ„å›¾ä¸­çš„è§’è‰²åç§°æ¥æŸ¥æ‰¾CharacterDetailï¼Œç„¶ååˆ›å»ºä¸€ä¸ªåŒ…å«è¯¥è§’è‰²ç»†èŠ‚çš„æ¡ç›®çš„æ—¶é—´çº¿ã€‚

```swift
struct CharacterDetailProvider: IntentTimelineProvider {
    func timeline(for configuration: SelectCharacterIntent, with context: Context, completion: @escaping (Timeline<CharacterDetailEntry>) -> ()) {
        // è®¿é—® intent çš„è‡ªå®šä¹‰å±æ€§
        let characterDetail = lookupCharacterDetail(for: configuration.character.name)

        // æ„é€ ä¸€ä¸ªå½“å‰æ—¥æœŸçš„æ—¶é—´çº¿æ¡ç›®ï¼Œå¹¶åŒ…å«äººç‰©ç»†èŠ‚
        let entry = CharacterDetailEntry(date: Date(), detail: characterDetail)

        // åˆ›å»ºæ—¶é—´çº¿å¹¶è°ƒç”¨å®Œæˆå¤„ç†ç¨‹åºã€‚é…ç½®ä¸ºNever - æ°¸ä¸åˆ·æ–°
        // ç­–ç•¥è¡¨æ˜åŒ…å«çš„åº”ç”¨ç¨‹åºå°†ä½¿ç”¨WidgetCenteræ–¹æ³•ã€‚
        // å½“ç»†èŠ‚å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‡æ–°åŠ è½½å°ç»„ä»¶çš„æ—¶é—´çº¿
        let timeline = Timeline(entries: [entry], policy: .never)
        completion(timeline)
    }
}
```

å½“æ‚¨åœ¨æ—¶é—´çº¿æ¡ç›®ä¸­åŒ…å«ç”¨æˆ·è‡ªå®šä¹‰çš„å€¼æ—¶ï¼Œæ‚¨çš„å°ç»„ä»¶å¯ä»¥æ˜¾ç¤ºé€‚å½“çš„å†…å®¹ã€‚